{% extends 'base.html' %}
{% block title %}èª²ç¨‹åˆ—è¡¨{% endblock %}

{% block content %}
<div class="container">
    
    {# ========== [æƒ…å¢ƒ A] å­¸ç”Ÿç•«é¢ï¼šé¡¯ç¤ºã€Œå·²é¸ã€èˆ‡ã€Œå¯åŠ é¸ã€ ========== #}
    {% if role == 'student' %}
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>æˆ‘çš„èª²ç¨‹</h2>
            <span class="badge bg-secondary fs-6">æœ¬å­¸æœŸå¹³å‡ï¼š{{ semester_avg|default:"0" }}</span>
        </div>

        <div class="row mb-5">
            {% for enrollment in enrollments %}
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm border-primary">
                    <div class="card-body">
                        <h5 class="card-title text-primary">{{ enrollment.course.name }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ enrollment.course.course_id }}</h6>
                        <p class="card-text">
                            ğŸ‘¨â€ğŸ« è€å¸«ï¼š{{ enrollment.course.teacher.name }}<br>
                            ğŸ“Š æˆç¸¾ï¼š{{ enrollment.average }}
                        </p>
                        <div class="d-flex gap-2">
                            <a href="{% url 'course_detail' enrollment.course.id %}" class="btn btn-outline-primary btn-sm flex-grow-1">
                                æŸ¥çœ‹/ç•™è¨€
                            </a>
                            <a href="{% url 'drop_course' enrollment.course.id %}" class="btn btn-danger btn-sm" onclick="return confirm('ç¢ºå®šè¦é€€é¸å—ï¼Ÿæˆç¸¾å°‡æœƒæ¶ˆå¤±å–”ï¼')">
                                ğŸ—‘ï¸ é€€é¸
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="alert alert-warning">ç›®å‰æ²’æœ‰ä¿®èª²ï¼Œè«‹åƒè€ƒä¸‹æ–¹èª²ç¨‹åˆ—è¡¨é€²è¡ŒåŠ é¸ã€‚</div>
            </div>
            {% endfor %}
        </div>

        <h3 class="mb-3 border-bottom pb-2">å…¶ä»–å¯åŠ é¸èª²ç¨‹</h3>
        
        <div class="row">
            {% for course in available_courses %}
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm bg-light">
                    <div class="card-body">
                        <h5 class="card-title">{{ course.name }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ course.course_id }}</h6>
                        <p class="card-text">è€å¸«ï¼š{{ course.teacher.name }}</p>
                        <a href="{% url 'enroll_course' course.id %}" class="btn btn-success btn-sm w-100">
                            â• æˆ‘è¦åŠ é¸
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-muted">ç›®å‰æ²’æœ‰å…¶ä»–èª²ç¨‹å¯ä¾›åŠ é¸ã€‚</div>
            {% endfor %}
        </div>

    {# ========== [æƒ…å¢ƒ B] è€å¸«/ç®¡ç†å“¡ç•«é¢ï¼šé¡¯ç¤ºæ‰€æœ‰èª²ç¨‹èˆ‡ç®¡ç†åŠŸèƒ½ ========== #}
    {% else %}
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>æ‰€æœ‰èª²ç¨‹åˆ—è¡¨</h2>
            {% if role == 'teacher' or role == 'admin' %}
                <a href="{% url 'add_course' %}" class="btn btn-primary">â• æ–°å¢èª²ç¨‹</a>
            {% endif %}
        </div>

        <div class="row">
            {% for course in courses %}
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">{{ course.name }}</h5>
                        <p class="card-text">è€å¸«ï¼š{{ course.teacher.name }}</p>
                        <a href="{% url 'course_detail' course.id %}" class="btn btn-outline-primary btn-sm">æŸ¥çœ‹è©³æƒ…</a>
                        <a href="{% url 'grade_course' course.id %}" class="btn btn-warning btn-sm">âœï¸ æ‰“åˆ†æ•¸</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}