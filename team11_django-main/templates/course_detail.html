{% extends 'base.html' %}

{% block title %}{{ course.name }} - è©³æƒ…{% endblock %}

{% block content %}
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3>{{ course.name }} <small class="text-muted">({{ course.course_id }})</small></h3>
                        
                        {# ========== [å€åŸŸ 1] åªæœ‰è€å¸«çœ‹å¾—åˆ°çš„æŒ‰éˆ• ========== #}
                        {% if is_teacher %}
                        <a href="{% url 'grade_course' course.id %}" class="btn btn-warning">
                            âœï¸ è¼¸å…¥/ä¿®æ”¹æˆç¸¾
                        </a>
                        {% endif %}
                        {# ============================================== #}

                    </div>
                    
                    <p>æˆèª²æ•™å¸«ï¼š<strong>{{ course.teacher.name }}</strong></p>

                    <h5 class="mt-4 border-bottom pb-2">å­¸ç”Ÿåå–®èˆ‡æˆç¸¾</h5>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>å­¸ç”Ÿ</th>
                                <th>æœŸä¸­</th>
                                <th>æœŸæœ«</th>
                                <th>å¹³å‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for e in enrollments %}
                            <tr>
                                <td>{{ e.student.name }}</td>
                                <td>{{ e.midterm_score }}</td>
                                <td>{{ e.final_score }}</td>
                                <td>{{ e.average }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="4">å°šç„¡å­¸ç”Ÿé¸ä¿®ã€‚</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <div class="mt-3">
                        <a class="btn btn-outline-primary" href="{% url 'course_list' %}">å›èª²ç¨‹åˆ—è¡¨</a>
                    </div>
                </div>
            </div>
            
            {# ========== [å€åŸŸ 2] å…¬å…±å€åŸŸï¼šå­¸ç”Ÿè·Ÿè€å¸«éƒ½çœ‹å¾—åˆ°ç•™è¨€æ¿ ========== #}
            {# å› ç‚ºé€™è£¡æ²’æœ‰åŒ…åœ¨ if is_teacher è£¡é¢ï¼Œæ‰€ä»¥å­¸ç”Ÿä¹Ÿçœ‹å¾—åˆ° #}
            
            <hr class="my-5">

            <div class="row">
                <div class="col-lg-12">
                    <h4 class="mb-3">ğŸ’¬ èª²ç¨‹è¨è«–å€</h4>
                    
                    <div class="card bg-light mb-4">
                        <div class="card-body">
                            <form method="post">
                                {% csrf_token %}
                                <div class="mb-2">
                                    {{ comment_form.content }}
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary btn-sm">é€å‡ºç•™è¨€</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="list-group">
                        {% for comment in comments %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 fw-bold">
                                    {% if comment.user.student.avatar %}
                                        <img src="{{ comment.user.student.avatar.url }}" width="24" height="24" class="rounded-circle me-1">
                                    {% endif %}
                                    
                                    {{ comment.user.student.name|default:comment.user.username }}
                                    
                                    <small class="text-muted fw-normal">
                                        {% if comment.user.teacher %}(è€å¸«){% endif %}
                                        {% if comment.user.student %}(å­¸ç”Ÿ){% endif %}
                                    </small>
                                </h6>
                                <small class="text-muted">{{ comment.created_at|date:"Y/m/d H:i" }}</small>
                            </div>
                            <p class="mb-1 mt-2">{{ comment.content|linebreaksbr }}</p>
                            
                            {% if request.user == comment.user %}
                                <small><a href="{% url 'delete_comment' comment.id %}" class="text-danger text-decoration-none" onclick="return confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')">ğŸ—‘ï¸ åˆªé™¤</a></small>
                            {% endif %}
                        </div>
                        {% empty %}
                        <div class="text-center text-muted py-3">
                            ç›®å‰é‚„æ²’æœ‰ç•™è¨€ï¼Œå¿«ä¾†æ¶é ­é¦™ï¼
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {# ======================================================== #}

        </div>
    </div>
{% endblock %}